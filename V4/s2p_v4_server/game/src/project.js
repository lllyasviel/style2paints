require=function r(a,d,c){function s(t,e){if(!d[t]){if(!a[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(w)return w(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var i=d[t]={exports:{}};a[t][0].call(i.exports,function(e){var n=a[t][1][e];return s(n||e)},i,i.exports,r,a,d,c)}return d[t].exports}for(var w="function"==typeof require&&require,e=0;e<c.length;e++)s(c[e]);return s}({BoxCanvas:[function(e,n,t){"use strict";cc._RF.push(n,"fe52erRfo9NV5lQabMArD3F","BoxCanvas"),n.exports=function(e){var t=Object();return t.spriteFrame=new cc.SpriteFrame,t.texture2d=null,t.canvas=document.createElement("canvas"),t.canvas.id="canvas_"+e,t.ini=function(e,n){return t.canvas.width=parseInt(e),t.canvas.height=parseInt(n),t.ctx=t.canvas.getContext("2d"),t.ctx.fillStyle=t.ctx.createPattern(window.boxLoader.image,"repeat"),t.ctx.fillRect(0,0,t.canvas.width,t.canvas.height),t.texture2d=new cc.Texture2D,t.spriteFrame.setTexture(t.texture2d),t.texture2d.initWithElement(t.canvas),t.texture2d.handleLoadedTexture(!0),t.spriteFrame},t},cc._RF.pop()},{}],CreativeCanvas:[function(e,n,t){"use strict";var o,p;cc._RF.push(n,"e7a806R1yBHDIRZPIq8JNfk","CreativeCanvas"),n.exports=((p=Object()).spriteFrame=new cc.SpriteFrame,p.texture2d=null,p.canvas=document.createElement("canvas"),p.canvas.id="canvas_"+o,p.finalData=null,p.points_XYRGBR=[],p.current_index=0,p.records=[],p.time_line=0,p.prex=0,p.prey=0,p.re=!1,p.rex=0,p.rey=0,p.in_drag=!1,p.ctx=null,p.create_k=function(){p.records=p.records.splice(0,p.time_line+1),p.records.push(JSON.stringify(window.creativeCanvas.points_XYRGBR)),p.time_line++,this.flush_bg()},p.undo=function(){p.time_line--,p.time_line<0&&(p.time_line=0),p.do(),this.flush_bg()},p.redo=function(){p.time_line++,p.time_line>p.records.length-1&&(p.time_line=p.records.length-1),p.do(),this.flush_bg()},p.do=function(){window.creativeCanvas.points_XYRGBR=JSON.parse(p.records[p.time_line]),p.finish()},p.ini=function(e,n){return p.canvas.width=parseInt(e),p.canvas.height=parseInt(n),p.ctx=p.canvas.getContext("2d"),p.ctx.clearRect(0,0,p.canvas.width,p.canvas.height),p.source=p.ctx.getImageData(0,0,p.canvas.width,p.canvas.height),p.texture2d=new cc.Texture2D,p.spriteFrame.setTexture(p.texture2d),p.texture2d.initWithElement(p.canvas),p.texture2d.handleLoadedTexture(!0),p.records=[JSON.stringify([])],p.points_XYRGBR=[],p.time_line=0,p.finish(),p.spriteFrame},p.ini_image=function(e,n,t){return ctx=p.canvas.getContext("2d"),p.canvas.width=parseInt(n),p.canvas.height=parseInt(t),ctx.drawImage(e,0,0,p.canvas.width,p.canvas.height),p.source=ctx.getImageData(0,0,p.canvas.width,p.canvas.height),p.texture2d=new cc.Texture2D,p.spriteFrame.setTexture(p.texture2d),p.texture2d.initWithElement(p.canvas),p.texture2d.handleLoadedTexture(!0),p.create_k(),this.flush_bg(),p.spriteFrame},p.flush=function(){var e=p.canvas.getContext("2d");p.source=e.getImageData(0,0,p.canvas.width,p.canvas.height)},p.flush_bg=function(){},p.kill_preview=function(){window.pendingNode.active=!1,window.previewNode.opacity=255},p.get_color=function(e,n){if(null==p.source)return new[0,0,0,0];var t=0;return t=parseInt((1-n)*p.canvas.height),t=parseInt(t*p.canvas.width),t=parseInt(t+e*p.canvas.width),t=parseInt(4*t),[p.source.data[t+0],p.source.data[t+1],p.source.data[t+2],p.source.data[t+3]]},p.set_big_point=function(e,n,t,o,i,r,a){p.ctx.fillStyle="rgba("+t+","+o+","+i+","+r+")",p.ctx.fillRect(e-a,n-a,2*a+1,2*a+1)},p.set_line=function(e,n,t,o,i,r,a,d,c){for(var s=Math.abs(t-e),w=Math.abs(o-n),l=e<t?1:-1,u=n<o?1:-1,h=s-w;p.set_big_point(e,n,i,r,a,d,c),e!=t||n!=o;){var g=2*h;-w<g&&(h-=w,e+=l),g<s&&(h+=s,n+=u)}},p.clear_points=function(){p.points_XYRGBR=[]},p.add_point=function(){5==window.minecraft.index?p.points_XYRGBR.push([p.rex,p.rey,0,233,1]):6==window.minecraft.index?p.points_XYRGBR.push([p.rex,p.rey,1,233,0]):p.points_XYRGBR.push([p.rex,p.rey,window.pickCanvas.currentColor[0],window.pickCanvas.currentColor[1],window.pickCanvas.currentColor[2]]),p.current_index=p.points_XYRGBR.length-1},p.relocate_current_point=function(){-1<p.current_index&&p.current_index<p.points_XYRGBR.length&&(p.points_XYRGBR[p.current_index][0]=p.rex,p.points_XYRGBR[p.current_index][1]=p.rey)},p.refresh_current_point_index=function(e){p.current_index=-1;var n=parseInt(50/(window.drag_target.scaleX+1e-6));for(var t in window.isPen&&(n/=2),p.points_XYRGBR){var o=(p.points_XYRGBR[t][0]-p.rex)*p.canvas.width,i=(p.points_XYRGBR[t][1]-p.rey)*p.canvas.height;o*o+i*i<n*n&&p.if_point_in_color(t)==window.in_color&&(p.current_index=t)}-1<p.current_index?document.body.style.cursor="move":document.body.style.cursor="auto"},p.if_point_in_color=function(e){var n=p.points_XYRGBR[e],t=n[2],o=n[3],i=n[4];return!(1==t&&233==o&&0==i||0==t&&233==o&&1==i)},p.finish=function(){if(null!=p.ctx){p.ctx.clearRect(0,0,p.canvas.width,p.canvas.height);for(var e=0;e<p.points_XYRGBR.length;e++){var n=p.points_XYRGBR[e],t=parseInt(n[0]*p.canvas.width),o=parseInt((1-n[1])*p.canvas.height),i=n[2],r=n[3],a=n[4];if(1==i&&233==r&&0==a){if(window.in_color)continue;p.ctx.strokeStyle="#000000",p.ctx.lineWidth=4.5,p.ctx.beginPath(),p.ctx.moveTo(t-12,o-12),p.ctx.lineTo(t+12,o+12),p.ctx.closePath(),p.ctx.stroke(),p.ctx.beginPath(),p.ctx.moveTo(t+12,o-12),p.ctx.lineTo(t-12,o+12),p.ctx.closePath(),p.ctx.stroke(),p.ctx.strokeStyle="#ffffff",p.ctx.lineWidth=1.5,p.ctx.beginPath(),p.ctx.moveTo(t-10,o-10),p.ctx.lineTo(t+10,o+10),p.ctx.closePath(),p.ctx.stroke(),p.ctx.beginPath(),p.ctx.moveTo(t+10,o-10),p.ctx.lineTo(t-10,o+10),p.ctx.closePath(),p.ctx.stroke()}else if(0==i&&233==r&&1==a){if(window.in_color)continue;p.ctx.strokeStyle="#000000",p.ctx.lineWidth=4.5,p.ctx.beginPath(),p.ctx.arc(t,o,10,0,2*Math.PI),p.ctx.closePath(),p.ctx.stroke(),p.ctx.strokeStyle="#ffffff",p.ctx.lineWidth=1.5,p.ctx.beginPath(),p.ctx.arc(t,o,10,0,2*Math.PI),p.ctx.closePath(),p.ctx.stroke()}else{if(!window.in_color)continue;p.ctx.strokeStyle="rgba("+(255-i).toString()+","+(255-r).toString()+","+(255-a).toString()+",1.0)",p.ctx.fillStyle="rgba("+i.toString()+","+r.toString()+","+a.toString()+",1.0)",p.ctx.lineWidth=1.5,p.ctx.beginPath(),p.ctx.moveTo(t-7,o-7),p.ctx.lineTo(t-7,o+7),p.ctx.lineTo(t+7,o+7),p.ctx.lineTo(t+7,o-7),p.ctx.closePath(),p.ctx.fill(),p.ctx.stroke()}}}},p),cc._RF.pop()},{}],FileInputs:[function(e,n,t){"use strict";var o;cc._RF.push(n,"905c5qeemxJLpQ8dr1wfPNY","FileInputs"),n.exports=((o=Object()).html_obj=document.createElement("input"),o.html_obj.id="FileSelector",o.html_obj.type="file",o.html_obj.accept="image/*",o.html_obj.style.height="0px",o.html_obj.style.display="block",o.html_obj.style.overflow="hidden",document.body.insertBefore(o.html_obj,document.body.firstChild),o.actural_callback=null,o.url="",o.fake_callback=function(e){void 0!==window.URL?o.url=window.URL.createObjectURL(e.target.files[0]):o.url=window.webkitURL.createObjectURL(e.target.files[0]),o.actural_callback(o.url)},o.html_obj.addEventListener("change",o.fake_callback,!1),o.activate=function(e){o.actural_callback=e,o.html_obj.click()},o),cc._RF.pop()},{}],ImageCanvas:[function(e,n,t){"use strict";cc._RF.push(n,"8fc68P9vqxERoq8iKAIOEEI","ImageCanvas"),n.exports=function(e){var p=Object();return p.spriteFrame=new cc.SpriteFrame,p.texture2d=null,p.source=null,p.canvas=document.createElement("canvas"),p.canvas.id="canvas_"+e,p.image=null,p.load_image=function(e,n,t){p.image=e,p.canvas.width=parseInt(n),p.canvas.height=parseInt(t);var o=p.canvas.getContext("2d");return o.drawImage(e,0,0,p.canvas.width,p.canvas.height),p.dataurl=p.canvas.toDataURL("image/png"),p.source=o.getImageData(0,0,p.canvas.width,p.canvas.height),p.texture2d=new cc.Texture2D,p.spriteFrame.setTexture(p.texture2d),p.texture2d.initWithElement(p.canvas),p.texture2d.handleLoadedTexture(!0),p.spriteFrame},p.load_canvas=function(e){p.canvas.width=e.width,p.canvas.height=e.height;var n=p.canvas.getContext("2d");return n.drawImage(e,0,0,p.canvas.width,p.canvas.height),p.source=n.getImageData(0,0,p.canvas.width,p.canvas.height),p.texture2d=new cc.Texture2D,p.spriteFrame.setTexture(p.texture2d),p.texture2d.initWithElement(p.canvas),p.texture2d.handleLoadedTexture(!0),p.spriteFrame},p.clear=function(){p.canvas.width=100,p.canvas.height=100;var e=p.canvas.getContext("2d");return e.clearRect(0,0,100,100),p.source=e.getImageData(0,0,p.canvas.width,p.canvas.height),p.texture2d=new cc.Texture2D,p.spriteFrame.setTexture(p.texture2d),p.texture2d.initWithElement(p.canvas),p.texture2d.handleLoadedTexture(!0),p.spriteFrame},p.dark=function(){p.canvas.width=100,p.canvas.height=100;var e=p.canvas.getContext("2d");return e.fillStyle="rgba(0,0,0,0.5)",e.fillRect(0,0,100,100),p.source=e.getImageData(0,0,p.canvas.width,p.canvas.height),p.texture2d=new cc.Texture2D,p.spriteFrame.setTexture(p.texture2d),p.texture2d.initWithElement(p.canvas),p.texture2d.handleLoadedTexture(!0),p.spriteFrame},p.load_alpha=function(e,n,t){p.image=e,p.canvas.width=parseInt(n),p.canvas.height=parseInt(t);var o=p.canvas.getContext("2d");o.drawImage(e,0,0,p.canvas.width,p.canvas.height),p.dataurl=p.canvas.toDataURL("image/png"),p.source=o.getImageData(0,0,p.canvas.width,p.canvas.height);for(var i=0;i<t;i++)for(var r=0;r<n;r++){var a=4*(r+i*n),d=a+1,c=a+2,s=a+3,w=p.source.data[a],l=p.source.data[d],u=p.source.data[c],h=p.source.data[s],g=Math.max((1*w+1*l+1*u)/3,255-h);p.source.data[a]=0,p.source.data[d]=0,p.source.data[c]=0,p.source.data[s]=255-g}return o.putImageData(p.source,0,0),p.texture2d=new cc.Texture2D,p.spriteFrame.setTexture(p.texture2d),p.texture2d.initWithElement(p.canvas),p.texture2d.handleLoadedTexture(!0),p.spriteFrame},p.get_color=function(e,n){if(null==p.source)return new cc.color(255,255,255);var t=0;return t=parseInt((1-n)*p.canvas.height),t=parseInt(t*p.canvas.width),t=parseInt(t+e*p.canvas.width),t=parseInt(4*t),new cc.color(p.source.data[t],p.source.data[t+1],p.source.data[t+2])},p},cc._RF.pop()},{}],ImageLoader:[function(e,n,t){"use strict";cc._RF.push(n,"28e74s7diBLh5Ox7WgbLlpC","ImageLoader"),n.exports=function(e){var i=Object(),n="tempDiv"+e,r="imgHead"+e,t=document.createElement("div");return t.style.position="absolute",t.id=n,t.innerHTML="<img id="+r+">",t.style.display="none",t.style.visibility="hidden",document.body.appendChild(t),i.image=document.getElementById(r),i.on_process=null,i.on_error=null,i.on_finish=null,i.load_url=function(t,e){i.image.onload=function(){e(document.getElementById(r))},i.image.onerror=function(){null!=i.on_error&&i.on_error()};var o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="arraybuffer",o.onprogress=function(e){e.lengthComputable&&(console.log(t+" - "+e.loaded+" / "+e.total),null!=i.on_process&&i.on_process(e.loaded/e.total))},o.onreadystatechange=function(){if(4==o.readyState&&200==o.status)try{null!=i.on_finish&&(console.log(t+" - on_finish called"),i.on_finish());var e=o.getAllResponseHeaders().match(/^Content-Type\:\s*(.*?)$/im)[1]||"image/png",n=new Blob([this.response],{type:e});console.log(t+" - finished"),i.image.src=window.URL.createObjectURL(n),console.log(t+" - blobed")}catch(e){console.log(e),null!=i.on_error&&i.on_error()}else 4==o.readyState&&null!=i.on_error&&i.on_error()},o.send()},i},cc._RF.pop()},{}],PickCanvas:[function(e,n,t){"use strict";cc._RF.push(n,"076a0aT+NZGT7xs77Y6v1Zy","PickCanvas"),n.exports=function(e){var k=Object();return k.spriteFrame=new cc.SpriteFrame,k.texture2d=null,k.source=null,k.canvas=document.createElement("canvas"),k.canvas.id="canvas_"+e,k.canvas.width=300,k.canvas.height=1078,k.currentColor=new Array(255,230,200),k.floatingColor=new Array(0,255,0),k.bigall=[47079079,112128144,119136153,105105105,169169169,211211211,220220220,176196222,139,25025112,72061139,75000130,205,123104238,65105225,100149237,139187,70130180,30144255,191255,135206250,135206235,173216230,255255,95158160,32178170,102205170,206209,72209204,64224208,176224230,175238238,107142035,85107047,1e5,34139034,46139087,60179113,50205050,154205050,127255212,250154,255127,124252e3,127255e3,173255047,144238144,152251152,139000139,106090205,138043226,148000211,153050204,186085211,147112219,143188143,139e6,139069019,165042042,178034034,160082045,205092092,210105030,189183107,220020060,255020147,255105180,255000255,218112214,238130238,221160221,216191216,188143143,199021133,219112147,233150122,240128128,255160122,255182193,255192203,255069e3,255099071,255079080,250128114,25514e4,255165e3,244164096,230230250,184134011,205133063,218165032,210180140,222184135,255215e3,255228225,224255255,240230140,238232170,250250210,255250205,245245220,255248220,255255224,255218185,245222179,255222173,255228181,255228196,255235205,255239213,250235215,255240245,240221195,234182156,240221208,247206181,238187153,240208182,234169143,221169143,247217214,226199179,247195156,221169130,234208182,240186173,166149141,240221182,234195169,212128107,158139130,234182143,247208195,247182156,235178133,247195169,247208182,240195169,195116077,240208169,234195182,240169130,69042029,247208169,247221195,240182143,236221202,249249249],k.record=[],k.ctx=k.canvas.getContext("2d"),k.ring=null,k.tring=null,k.ini=function(e){return k.ctx.drawImage(e,0,0,300,300),k.ring=k.ctx.getImageData(0,0,300,300),k.tring=k.ctx.getImageData(0,0,164,164),k.source=k.ctx.getImageData(0,0,k.canvas.width,k.canvas.height),k.texture2d=new cc.Texture2D,k.spriteFrame.setTexture(k.texture2d),k.texture2d.initWithElement(k.canvas),k.texture2d.handleLoadedTexture(!0),k.ctx=k.texture2d.getHtmlElementObj().getContext("2d"),k.finish(),k.spriteFrame},k.finish=function(e){if(null!=k.ring){var n=0;k.ctx.fillStyle="rgb(80, 80, 80)",k.ctx.fillRect(0,0,k.canvas.width,k.canvas.height),k.ctx.putImageData(k.ring,0,n),n+=300;for(var t=1*Math.min(Math.min(k.currentColor[0],k.currentColor[1]),k.currentColor[2]),o=1*Math.max(Math.max(k.currentColor[0],k.currentColor[1]),k.currentColor[2])-t+1e-4,i=(1*k.currentColor[0]-t+1e-4)/o*255,r=(1*k.currentColor[1]-t+1e-4)/o*255,a=(1*k.currentColor[2]-t+1e-4)/o*255,d=0;d<164;d++)for(var c=0;c<164;c++){var s=4*(164*d+163-c),w=s+1,l=s+2,u=s+3,h=1*d/164*255,g=1*c/164*(255-h)/255;k.tring.data[s]=h+i*g,k.tring.data[w]=h+r*g,k.tring.data[l]=h+a*g,k.tring.data[u]=255}k.ctx.putImageData(k.tring,68,68),n+=0,k.ctx.fillStyle="rgb("+k.currentColor[0]+","+k.currentColor[1]+", "+k.currentColor[2]+")",k.ctx.fillRect(8,n+5,142,30),k.ctx.fillStyle="rgb("+k.floatingColor[0]+","+k.floatingColor[1]+", "+k.floatingColor[2]+")",k.ctx.fillRect(150,n+5,142,30),n+=40;for(var p=0;p<k.record.length;p++){var _=parseInt(p%8),v=parseInt(p/8),f=k.record[k.record.length-1-p],m=f%1e3,x=(f=parseInt(f/1e3))%1e3,C=(f=parseInt(f/1e3))%1e3;k.ctx.beginPath(),k.ctx.fillStyle="rgb("+C+","+x+", "+m+")",k.ctx.arc(parseInt(38*_+19),parseInt(n+38*v+19),16,0,2*Math.PI,!0),k.ctx.closePath(),k.ctx.fill()}k.source=k.ctx.getImageData(0,0,k.canvas.width,k.canvas.height)}},k.finish_float=function(e){if(null!=k.ring){k.ctx.fillStyle="rgb("+k.floatingColor[0]+","+k.floatingColor[1]+", "+k.floatingColor[2]+")",k.ctx.fillRect(150,305,142,30)}},k.get_color=function(e,n){if(null==k.source)return new cc.color(255,255,255);var t=0;return t=parseInt((1-n)*k.canvas.height),t=parseInt(t*k.canvas.width),t=parseInt(t+e*k.canvas.width),t=parseInt(4*t),new cc.color(k.source.data[t],k.source.data[t+1],k.source.data[t+2])},k},cc._RF.pop()},{}],SizeRegulator:[function(e,n,t){"use strict";cc._RF.push(n,"45ffcOaBs5DwLbHaSSfzUG/","SizeRegulator"),n.exports.minRegulate=function(e,n){var t=parseFloat(e[0]),o=parseFloat(e[1]);return o<t?(t*=n/o,o=n):(o*=n/t,t=n),[parseInt(t),parseInt(o)]},n.exports.maxRegulate=function(e,n){var t=parseFloat(e[0]),o=parseFloat(e[1]);return t<o?(t*=n/o,o=n):(o*=n/t,t=n),[parseInt(t),parseInt(o)]},cc._RF.pop()},{}],TripleCanvas:[function(e,n,t){"use strict";cc._RF.push(n,"7319cMXNsxIhLHpuS9egChN","TripleCanvas"),n.exports=function(e){var F=Object();return F.spriteFrame=new cc.SpriteFrame,F.texture2d=null,F.spriteFrame_p=new cc.SpriteFrame,F.texture2d_p=null,F.source=null,F.source_light=null,F.source_color=null,F.canvas=document.createElement("canvas"),F.canvas.id="canvas_"+e,F.canvas_light=document.createElement("canvas"),F.canvas_light.id="canvas_light"+e,F.canvas_sketch=document.createElement("canvas"),F.canvas_sketch.id="canvas_sketch"+e,F.canvas_color=document.createElement("canvas"),F.canvas_color.id="canvas_color"+e,F.canvas_preview=document.createElement("canvas"),F.canvas_preview.id="canvas_preview"+e,F.canvas_render=document.createElement("canvas"),F.canvas_render.id="canvas_render"+e,F.canvas_shade=document.createElement("canvas"),F.canvas_shade.id="canvas_shade"+e,F.load_image=function(e,n,t){var o=null,i=parseInt(n/3);F.canvas_preview.width=parseInt(n),F.canvas_preview.height=parseInt(t),F.canvas.width=parseInt(i),F.canvas.height=parseInt(t),F.canvas_sketch.width=parseInt(i),F.canvas_sketch.height=parseInt(t),F.canvas_light.width=parseInt(i),F.canvas_light.height=parseInt(t),F.canvas_color.width=parseInt(i),F.canvas_color.height=parseInt(t),F.canvas_render.width=parseInt(i),F.canvas_render.height=parseInt(t),F.canvas_shade.width=parseInt(i),F.canvas_shade.height=parseInt(t),(o=F.canvas_preview.getContext("2d")).drawImage(e,0,0,F.canvas_preview.width,F.canvas_preview.height),F.source_sketch=o.getImageData(0,0,F.canvas.width,F.canvas.height),F.texture2d_p=new cc.Texture2D,F.spriteFrame_p.setTexture(F.texture2d_p),F.texture2d_p.initWithElement(F.canvas_preview),F.texture2d_p.handleLoadedTexture(!0),(o=F.canvas_sketch.getContext("2d")).drawImage(F.canvas_preview,0,0,F.canvas.width,F.canvas.height,0,0,F.canvas.width,F.canvas.height),(o=F.canvas.getContext("2d")).drawImage(F.canvas_preview,i,0,F.canvas.width,F.canvas.height,0,0,F.canvas.width,F.canvas.height),F.texture2d=new cc.Texture2D,F.spriteFrame.setTexture(F.texture2d),F.texture2d.initWithElement(F.canvas),F.texture2d.handleLoadedTexture(!0),(o=F.canvas_render.getContext("2d")).drawImage(F.canvas_preview,2*i,0,F.canvas.width,F.canvas.height,0,0,F.canvas.width,F.canvas.height),o=F.canvas.getContext("2d"),F.source=o.getImageData(0,0,F.canvas.width,F.canvas.height),F.source_light=o.getImageData(0,0,F.canvas.width,F.canvas.height),F.source_color=o.getImageData(0,0,F.canvas.width,F.canvas.height);for(var r=0;r<t;r++)for(var a=0;a<i;a++){var d=4*(a+r*i),c=d+1,s=d+2,w=d+3,l=F.source.data[d],u=F.source.data[c],h=F.source.data[s],g=(F.source.data[w],F.source_sketch.data[d]),p=Math.max(l,u,h),_=Math.min(p,g);F.source_light.data[d]=_,F.source_light.data[c]=_,F.source_light.data[s]=_,F.source_light.data[w]=255,p<15&&(h=u=l=p),F.source_color.data[d]=parseInt((1*l+1e-4)/(1*p+1e-4)*255),F.source_color.data[c]=parseInt((1*u+1e-4)/(1*p+1e-4)*255),F.source_color.data[s]=parseInt((1*h+1e-4)/(1*p+1e-4)*255),F.source_color.data[w]=255}F.canvas_light.getContext("2d").putImageData(F.source_light,0,0),F.canvas_color.getContext("2d").putImageData(F.source_color,0,0),F.source=F.canvas_shade.getContext("2d").getImageData(0,0,F.canvas.width,F.canvas.height),F.source_from=F.canvas.getContext("2d").getImageData(0,0,F.canvas.width,F.canvas.height),F.source_to=F.canvas_render.getContext("2d").getImageData(0,0,F.canvas.width,F.canvas.height);for(var v=0;v<t;v++)for(var f=0;f<i;f++){var m=4*(f+v*i),x=m+1,C=m+2,k=m+3,I=F.source_from.data[m],b=F.source_from.data[x],N=F.source_from.data[C],y=(1*F.source_to.data[m]+1e-4)/(1*I+1e-4)*255,S=(1*F.source_to.data[x]+1e-4)/(1*b+1e-4)*255,R=(1*F.source_to.data[C]+1e-4)/(1*N+1e-4)*255;255<y&&(y=255),255<S&&(S=255),255<R&&(R=255),F.source.data[m]=parseInt(y),F.source.data[x]=parseInt(S),F.source.data[C]=parseInt(R),F.source.data[k]=255}F.canvas_shade.getContext("2d").putImageData(F.source,0,0)},F},cc._RF.pop()},{}],colorpicker:[function(t,e,n){"use strict";cc._RF.push(e,"292e9Clf/5EoYjj7Il6urD/","colorpicker"),Array.prototype.indexOf=function(e){for(var n=0;n<this.length;n++)if(this[n]==e)return n;return-1},Array.prototype.remove=function(e){var n=this.indexOf(e);-1<n&&this.splice(n,1)},cc.Class({extends:cc.Component,properties:{dropNode:{default:null,type:cc.Node}},onLoad:function(){window.color_picker_main=this},start:function(){var e=t("./ImageLoader"),n=t("./PickCanvas");window.pickCanvas=n("paletteImage"),window.right_color_picker=this.getComponent("cc.Sprite"),window.right_color_picker_node=this.node,window.color_picker_main=this,window.dropper_node=this.dropNode,this.last_record=0,e("paletteImage").load_url("res\\raw-assets\\Texture\\ring.png",function(e){window.right_color_picker.spriteFrame=window.pickCanvas.ini(e),window.right_color_picker_node.on("mousemove",function(e){window.mousePosition=e.getLocation();var n=window.right_color_picker_node,t=(n.convertToWorldSpace(n.position),cc.winSize.width-300),o=window.mousePosition.x-t,i=window.mousePosition.y-362;if(0<o&&0<i&&o<n.width&&i<n.height){window.mouseRelativeX=o/n.width,window.mouseRelativeY=i/n.height;var r=window.pickCanvas.get_color(window.mouseRelativeX,window.mouseRelativeY);80==r.r&&80==r.g&&80==r.b&&(r.r=255,r.g=255,r.b=255),window.color_picker_main.float_do(r)}}),window.right_color_picker_node.on("mousedown",function(e){window.color_picker_main.pick_do()})}),window.dropper_node.on(cc.Node.EventType.MOUSE_DOWN,this.onDropDown,this),window.dropper_node.on(cc.Node.EventType.MOUSE_UP,this.onDropUp,this),window.dropper_node.on(cc.Node.EventType.TOUCH_MOVE,this.onDropMove,this),window.in_dropping=!1},float_do:function(e){window.pickCanvas.floatingColor[0]=e.r,window.pickCanvas.floatingColor[1]=e.g,window.pickCanvas.floatingColor[2]=e.b,window.dropper_node.color=e,window.pickCanvas.finish_float()},pick_do:function(){window.dropper_node.x=122,window.dropper_node.y=268,window.minecraft.go_pen(),window.color_picker_main.pick_float(),window.minecraft.set_cur_color(window.pickCanvas.currentColor)},onDropDown:function(e){window.in_dropping=!0},onDropUp:function(e){window.in_dropping=!1,window.color_picker_main.pick_do()},onDropMove:function(e){if(window.in_dropping){var n=e.touch.getDelta();window.dropper_node.x+=n.x,window.dropper_node.y+=n.y;var t=.5*window.leftNode.width+1*window.drag_target.x-.5*window.drag_target.width*window.drag_target.scaleX+300,o=.5*window.leftNode.height+1*window.drag_target.y-.5*window.drag_target.height*window.drag_target.scaleX,i=(window.mousePosition.x-t)/(window.drag_target.width*window.drag_target.scaleX),r=(window.mousePosition.y-o)/(window.drag_target.height*window.drag_target.scaleX);if(0<i&&0<r&&i<1&&r<1)if(window.creativeCanvas.re=!0,window.creativeCanvas.rex=i,window.creativeCanvas.rey=r,window.creativeCanvas.refresh_current_point_index(),-1<window.creativeCanvas.current_index){var a=window.creativeCanvas.points_XYRGBR[window.creativeCanvas.current_index],d=[a[2],a[3],a[4]];window.color_picker_main.float_do(new cc.color(d[0],d[1],d[2])),window.minecraft.set_cur_color([d[0],d[1],d[2]])}else{var c=window.previewImageCanvas;window.girdNode.active&&(c=window.girdImageCanvas);var s=c.get_color(i,r);window.color_picker_main.float_do(s),window.minecraft.set_cur_color([s.r,s.g,s.b])}else window.creativeCanvas.re=!1}},pick_float:function(){window.controller.on_pen(),window.pickCanvas.currentColor[0]=window.pickCanvas.floatingColor[0],window.pickCanvas.currentColor[1]=window.pickCanvas.floatingColor[1],window.pickCanvas.currentColor[2]=window.pickCanvas.floatingColor[2],window.pickCanvas.finish()},make_record:function(){var e=1e6*window.pickCanvas.currentColor[0]+1e3*window.pickCanvas.currentColor[1]+window.pickCanvas.currentColor[2];this.last_record!=e&&(window.pickCanvas.record.remove(e),window.pickCanvas.record.push(e),window.pickCanvas.finish(),this.last_record=e)}}),cc._RF.pop()},{"./ImageLoader":"ImageLoader","./PickCanvas":"PickCanvas"}],controller:[function(i,e,n){"use strict";cc._RF.push(e,"a55dcSJ4f1CEaD9OSsdYeLl","controller"),cc.Class({extends:cc.Component,properties:{sketchNode:{default:null,type:cc.Node},alphaSketchNode:{default:null,type:cc.Node},hintNode:{default:null,type:cc.Node},bghintNode:{default:null,type:cc.Node},girdNode:{default:null,type:cc.Node},previewNode:{default:null,type:cc.Node},labelNode:{default:null,type:cc.Node},pendingNode:{default:null,type:cc.Node},fileBtnNode:{default:null,type:cc.Node},aiBtnNode:{default:null,type:cc.Node},magicBtnNode:{default:null,type:cc.Node},leftNode:{default:null,type:cc.Node},confirmNode:{default:null,type:cc.Node},logoNode:{default:null,type:cc.Node},cpNode:{default:null,type:cc.Node},lightNode:{default:null,type:cc.Node},processingNode:{default:null,type:cc.Node},V4_toggle:{default:null,type:cc.Toggle}},show_light:function(){window.controller.lightNode.y=181,window.in_color=!1,window.bghintNode.active=!0,window.creativeCanvas.finish(),window.minecraft.shift(),window.girdNode.active=!1,0==window.hasRender&&window.faceSeletor.flush_preview_light(),console.log("show_light")},hide_light:function(){window.controller.lightNode.y=4096,window.in_color=!0,window.bghintNode.active=!1,window.creativeCanvas.finish(),window.minecraft.shift(),window.girdNode.active=!1,console.log("hide_light")},to_gird:function(){this.hide_light(),window.girdNode.active=!0,console.log("to_gird")},on_pen:function(){window.isPen=!0,window.in_move=!1,window.eraser_masker.active=!1,console.log("on_pen")},on_eraser:function(){window.isPen=!1,window.in_move=!1,window.minecraft.set_index(-233),window.eraser_masker.active=!0,console.log("on_eraser")},on_upload_hints:function(){if(0!=window.hasSketch){var e=prompt("Points?");null!=e&&(window.creativeCanvas.points_XYRGBR=JSON.parse(e),window.creativeCanvas.finish(),window.creativeCanvas.create_k())}},on_download_hints:function(){if(0!=window.hasSketch){var e=window.open("about:blank").document;e.body.style.backgroundColor="#000000",e.writeln(JSON.stringify(window.creativeCanvas.points_XYRGBR))}},on_logo:function(){var e="https://style2paints.github.io/";"zh"==navigator.language.substring(0,2)&&(e="https://style2paints.github.io/README_zh"),"ja"==navigator.language.substring(0,2)&&(e="https://style2paints.github.io/README_ja"),window.open(e)},on_logo_en:function(){window.open("https://style2paints.github.io/")},on_logo_zh:function(){window.open("https://style2paints.github.io/README_zh")},on_logo_ja:function(){window.open("https://style2paints.github.io/README_ja")},on_twitter:function(){window.open("https://twitter.com/hashtag/style2paints?f=tweets&vertical=default")},on_github:function(){window.open("https://github.com/lllyasviel/style2paints")},on_file:function(){window.uploading||window.fileSelector.activate(window.controller.load_sketch)},on_result:function(){var e="";e+="<div><img src="+window.tripleCanvas.canvas.toDataURL('"image/png')+' width="512"></div>',e+="<div><img src="+window.server_url+"/rooms/"+window.current_room+"/YUV."+window.current_step+'.jpg width="512"></div>',e+="<div><img src="+window.tripleCanvas.canvas_render.toDataURL('"image/png')+' width="512"></div>',e+="<div><img src="+window.tripleCanvas.canvas_color.toDataURL('"image/png')+' width="512"></div>',e+="<div><img src="+window.tripleCanvas.canvas_light.toDataURL('"image/png')+' width="512"></div>',e+="<div><img src="+window.tripleCanvas.canvas_shade.toDataURL('"image/png')+' width="512"></div>',e+="<div><img src="+window.server_url+"/rooms/"+window.current_room+"/composition."+window.current_step+'.jpg width="512"></div>',e+="<div><img src="+window.server_url+"/rooms/"+window.current_room+"/gird."+window.current_step+'.jpg width="512"></div>',e+="<div><img src="+window.server_url+"/rooms/"+window.current_room+"/DEL."+window.current_step+'.jpg width="512"></div>',e+="<div><img src="+window.server_url+"/rooms/"+window.current_room+"/HSV."+window.current_step+'.jpg width="512"></div>',e+="<div><img src="+window.tripleCanvas.canvas_sketch.toDataURL('"image/png')+' width="512"></div>',e+="<div>"+JSON.stringify(window.creativeCanvas.points_XYRGBR)+"</div>",window.confirmNode.active=!1,window.open("about:blank").document.writeln('<html><head></head><body style="background-color:#C8C8C8">'+e+"</body></html>")},on_result_cancel:function(){window.confirmNode.active=!1},on_magic:function(){window.faceSeletor.flush_preview()},on_ai:function(){if(!window.uploading&&0!=window.hasSketch){window.controller.net_lock("uploading",0);var n=new XMLHttpRequest;n.open("POST",window.server_url+"/request_v2_result",!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded;"),n.upload.onprogress=function(e){if(e.lengthComputable){var n=e.loaded/e.total;.8<n?window.controller.net_lock("painting",0):window.controller.net_lock("uploading",n)}},n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){window.controller.net_lock("downloading",0);var e=n.responseText.split("_");window.current_room=e[0],window.current_step=e[1],console.log("get room id "+window.current_room),console.log("get step id "+window.current_step),window.resultImageLoader.on_process=function(e){window.controller.net_lock("downloading",e)},window.resultImageLoader.on_error=function(e){window.controller.net_unlock("error")},window.resultImageLoader.on_finish=function(e){window.controller.net_unlock("finished")},window.resultImageLoader.load_url(window.server_url+"/rooms/"+window.current_room+"/preview."+window.current_step+".jpg",function(e){window.tripleCanvas.load_image(e,e.width,e.height),window.confirmNode.active=!0,window.cpNode.width=cc.winSize.width-100,window.cpNode.height=cc.winSize.height-300,window.cpNodeSprite.spriteFrame=window.tripleCanvas.spriteFrame_p;var n=1*window.cpNode.width/(1*window.tripleCanvas.canvas_preview.width),t=1*window.cpNode.height/(1*window.tripleCanvas.canvas_preview.height),o=Math.min(n,t);window.cpNode.width=parseInt(1*window.tripleCanvas.canvas_preview.width*o),window.cpNode.height=parseInt(1*window.tripleCanvas.canvas_preview.height*o),window.previewSprite.spriteFrame=window.previewImageCanvas.load_canvas(window.tripleCanvas.canvas),window.bghintSprite.spriteFrame=window.renderImageCanvas.load_canvas(window.tripleCanvas.canvas_render),window.hasRender=!0,window.controller.net_unlock("finished"),window.girdImageLoader.on_error=null,window.girdImageLoader.on_process=null,window.girdImageLoader.on_finish=null,window.girdImageLoader.load_url(window.server_url+"/rooms/"+window.current_room+"/gird."+window.current_step+".jpg",function(e){window.girdSprite.spriteFrame=window.girdImageCanvas.load_image(e,e.width,e.height)})})}else 4==n.readyState&&window.controller.net_unlock("error")},n.send("room="+window.current_room+"&points="+encodeURIComponent(JSON.stringify(window.creativeCanvas.points_XYRGBR))+"&face="+(window.faceID<0?encodeURIComponent(window.faceImageCanvas.canvas.toDataURL("image/png")):"null")+"&faceID="+(window.faceID+65535)+"&need_render=1&skipper=null&inv4="+(window.V4_toggle.isChecked?"1":"0")+"&r="+window.lighter.light_R_slider.progress+"&g="+window.lighter.light_G_slider.progress+"&b="+window.lighter.light_B_slider.progress+"&h="+window.lighter.light_H_slider.progress+"&d="+window.light_direction),console.log("request sended")}},on_big_error:function(){var e="Network error. Please refresh this page.";"zh"==navigator.language.substring(0,2)&&(e="严重网络错误，请刷新。"),"ja"==navigator.language.substring(0,2)&&(e="ネットワークエラー、ページを更新してください。"),alert(e)},net_lock:function(e,n){console.log(e+" - net_lock -"+n),window.uploading=!0,window.fileBtnNode.active=!1,window.aiBtnNode.active=!1,window.magicBtnNode.active=!1,window.processingNode.active=!0,window.state_label.change(e,n)},net_unlock:function(e){console.log(e+" - net_unlock"),window.uploading=!1,window.fileBtnNode.active=!0,window.aiBtnNode.active=!0,window.magicBtnNode.active=!0,window.processingNode.active=!1,window.state_label.change(e,1)},onLoad:function(){window.controller=this,window.uploading=!1,window.server_url="http://127.0.0.1:8080",window.server_url="https://s2p.moe",window.server_url="",window.fileSelector=i("./FileInputs"),window.regulator=i("./SizeRegulator"),window.fileBtnNode=this.fileBtnNode,window.aiBtnNode=this.aiBtnNode,window.magicBtnNode=this.magicBtnNode,window.confirmNode=this.confirmNode,window.confirmNode.active=!1,window.sketchNode=this.sketchNode,window.sketchSprite=this.sketchNode.getComponent("cc.Sprite"),window.alphaSketchNode=this.alphaSketchNode,window.alphaSketchSprite=this.alphaSketchNode.getComponent("cc.Sprite"),window.cpNode=this.cpNode,window.cpNodeSprite=this.cpNode.getComponent("cc.Sprite"),window.hasSketch=!1,window.hasRender=!1,window.in_color=!0,window.hintNode=this.hintNode,window.hintSprite=this.hintNode.getComponent("cc.Sprite"),window.bghintNode=this.bghintNode,window.bghintSprite=this.bghintNode.getComponent("cc.Sprite"),window.bghintNode.active=!1,window.girdNode=this.girdNode,window.girdSprite=this.girdNode.getComponent("cc.Sprite"),window.girdNode.active=!1,window.previewNode=this.previewNode,window.previewSprite=this.previewNode.getComponent("cc.Sprite"),window.state_label=this.labelNode.getComponent("fake_bar"),window.pendingNode=this.pendingNode,window.pendingNode.active=!1,window.V4_toggle=this.V4_toggle;var e=i("./ImageLoader"),n=i("./ImageCanvas"),t=i("./BoxCanvas"),o=i("./TripleCanvas");window.sketchImageLoader=e("sketchImage"),window.sketchImageCanvas=n("sketchImage"),window.renderImageLoader=e("renderImage"),window.renderImageCanvas=n("renderImage"),window.girdImageLoader=e("girdImage"),window.girdImageCanvas=n("girdImage"),window.sketchBoxCanvas=t("sketchBox"),window.tripleCanvas=o("tripleCanvas"),window.hintImageLoader=e("hintImage"),window.resultImageLoader=e("resultImage"),window.previewImageLoader=e("previewImage"),window.previewImageCanvas=n("previewImage"),window.creativeCanvas=i("./CreativeCanvas"),window.boxLoader=e("boxLoader"),window.boxLoader.load_url("res\\raw-assets\\Texture\\board.png",function(e){}),window.leftNode=this.leftNode,window.isPen=!0,window.in_move=!1,window.current_room="new",window.current_step="new",window.logoNode=this.logoNode,window.processingNode=this.processingNode,window.processingNode.active=!1},start:function(){setTimeout(this.on_pen,500),setTimeout(this.hide_light,500)},load_sketch:function(e){window.sketchImageLoader.load_url(e,function(e){if(!(e.width>3*e.height||e.height>3*e.width)){window.previewSprite.spriteFrame=window.previewImageCanvas.clear(),window.current_room="new",window.current_step="new";var n=window.regulator.minRegulate([e.width,e.height],2048);window.sketchSprite.spriteFrame=window.sketchBoxCanvas.ini(e.width,e.height),window.alphaSketchSprite.spriteFrame=window.sketchImageCanvas.load_alpha(e,e.width,e.height),window.hintSprite.spriteFrame=window.creativeCanvas.ini(n[0],n[1]),window.bghintSprite.spriteFrame=window.renderImageCanvas.clear(),window.girdSprite.spriteFrame=window.girdImageCanvas.clear(),window.sketchNode.width=n[0],window.sketchNode.height=n[1],window.sketchNode.scaleX=1*(cc.winSize.height-300)/window.sketchNode.height*1,window.sketchNode.scaleY=window.sketchNode.scaleX,window.sketchNode.x=0,window.sketchNode.y=.5*cc.winSize.height-window.sketchNode.scaleY*window.sketchNode.height*.5-100,window.hasSketch=!0,window.logoNode.active=!1,window.controller.uploadSketch()}})},load_hints:function(e){window.sketchImageLoader.load_url(e,function(e){window.previewSprite.spriteFrame=window.previewImageCanvas.clear(),window.hintSprite.spriteFrame=window.creativeCanvas.ini_image(e,e.width,e.height)})},uploadSketch:function(){if(!window.uploading&&null!=window.sketchImageCanvas.source){window.controller.net_lock("initializing",0),window.current_room="new",window.current_step="new",window.creativeCanvas.kill_preview();var n=new XMLHttpRequest;n.open("POST",window.server_url+"/upload_v2_sketch",!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded;"),n.upload.onprogress=function(e){if(e.lengthComputable){var n=e.loaded/e.total;.8<n?window.controller.net_lock("preparing",0):window.controller.net_lock("initializing",n)}},n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){var e=n.responseText.split("_");window.current_room=e[0],window.current_step=e[1],console.log("get room id "+window.current_room),console.log("get step id "+window.current_step),window.controller.net_unlock("finished"),window.controller.hide_light(),window.creativeCanvas.flush_bg(),window.faceSeletor.flush_preview()}else 4==n.readyState&&(window.state_label.change("error",1),window.controller.on_big_error(),window.location.reload())},n.send("room="+window.current_room+"&sketch="+encodeURIComponent(window.sketchImageCanvas.dataurl)),console.log("sketch uploaded")}}}),cc._RF.pop()},{"./BoxCanvas":"BoxCanvas","./CreativeCanvas":"CreativeCanvas","./FileInputs":"FileInputs","./ImageCanvas":"ImageCanvas","./ImageLoader":"ImageLoader","./SizeRegulator":"SizeRegulator","./TripleCanvas":"TripleCanvas"}],dragbox:[function(e,n,t){"use strict";cc._RF.push(n,"6591e257m1DWrS+H2/IDVmm","dragbox"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){window.drag_box=this},start:function(){window.mouse_l=!1,window.mouse_r=!1,window.mouse_m=!1,window.ctrl=!1,window.alt=!1,(window.drag_box=this).node.on(cc.Node.EventType.MOUSE_DOWN,this.onMouseDown,this),this.node.on(cc.Node.EventType.MOUSE_UP,this.onMouseUp,this),this.node.on(cc.Node.EventType.MOUSE_WHEEL,this.onMouseWheel,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on("mousemove",function(e){window.mousePosition=e.getLocation();var n=.5*window.leftNode.width+1*window.drag_target.x-.5*window.drag_target.width*window.drag_target.scaleX+300,t=.5*window.leftNode.height+1*window.drag_target.y-.5*window.drag_target.height*window.drag_target.scaleX,o=(window.mousePosition.x-n)/(window.drag_target.width*window.drag_target.scaleX),i=(window.mousePosition.y-t)/(window.drag_target.height*window.drag_target.scaleX);0<o&&0<i&&o<1&&i<1?(window.creativeCanvas.re=!0,window.creativeCanvas.rex=o,window.creativeCanvas.rey=i,window.creativeCanvas.in_drag||window.creativeCanvas.refresh_current_point_index()):window.creativeCanvas.re=!1,window.alt&&(window.mouse_l||window.mouse_r||window.mouse_m||window.in_color&&window.drag_box.do_picking())}),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,function(e){e.keyCode==cc.KEY.z&&window.creativeCanvas.undo()}),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,function(e){e.keyCode==cc.KEY.y&&window.creativeCanvas.redo()}),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,function(e){switch(e.keyCode){case cc.KEY.ctrl:window.ctrl=!0;break;case cc.KEY.alt:window.alt||(window.alt=!0,window.in_color&&(window.drag_box.begin_picking(),window.drag_box.do_picking()))}},this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,function(e){switch(e.keyCode){case cc.KEY.ctrl:window.ctrl=!1;break;case cc.KEY.alt:window.alt=!1,window.in_color&&window.drag_box.end_picking()}},this)},onTouchMove:function(e){if(void 0!==window.drag_target)if(window.mouse_m||window.mouse_r||window.in_move){var n=e.touch.getDelta();window.drag_target.x+=n.x,window.drag_target.y+=n.y}else window.mouse_l&&(window.isPen?window.creativeCanvas.in_drag&&(window.creativeCanvas.relocate_current_point(),window.creativeCanvas.finish()):(window.creativeCanvas.refresh_current_point_index(),-1<window.creativeCanvas.current_index&&window.creativeCanvas.if_point_in_color(window.creativeCanvas.current_index)==window.in_color&&(window.creativeCanvas.points_XYRGBR.splice(window.creativeCanvas.current_index,1),window.creativeCanvas.finish())))},onMouseDown:function(e){var n=e.getButton();n===cc.Event.EventMouse.BUTTON_LEFT?(window.mouse_l=!0,window.creativeCanvas.re&&0==window.in_move&&(window.isPen?(window.creativeCanvas.current_index<0&&(window.creativeCanvas.add_point(),window.creativeCanvas.finish()),window.creativeCanvas.in_drag=!0):(window.creativeCanvas.refresh_current_point_index(),-1<window.creativeCanvas.current_index&&window.creativeCanvas.if_point_in_color(window.creativeCanvas.current_index)==window.in_color&&(window.creativeCanvas.points_XYRGBR.splice(window.creativeCanvas.current_index,1),window.creativeCanvas.finish())))):n===cc.Event.EventMouse.BUTTON_MIDDLE?window.mouse_m=!0:n===cc.Event.EventMouse.BUTTON_RIGHT&&(window.mouse_r=!0)},onMouseUp:function(e){var n=e.getButton();n===cc.Event.EventMouse.BUTTON_LEFT?(window.mouse_l=!1,window.creativeCanvas.in_drag=!1,window.creativeCanvas.create_k()):n===cc.Event.EventMouse.BUTTON_MIDDLE?window.mouse_m=!1:n===cc.Event.EventMouse.BUTTON_RIGHT&&(window.mouse_r=!1)},onMouseWheel:function(e){void 0!==window.drag_target&&(0<e.getScrollY()?window.drag_target.runAction(cc.scaleTo(.1,1.2*window.drag_target.scaleX)):window.drag_target.runAction(cc.scaleTo(.1,window.drag_target.scaleX/1.2)))},begin_picking:function(){void 0!==window.dropper_node&&window.creativeCanvas.flush()},do_picking:function(){if(void 0!==window.dropper_node){window.dropper_node.x=window.mousePosition.x-cc.winSize.width+150+30,window.dropper_node.y=window.mousePosition.y-cc.winSize.height/2-181+30;var e=.5*window.leftNode.width+1*window.drag_target.x-.5*window.drag_target.width*window.drag_target.scaleX+300,n=.5*window.leftNode.height+1*window.drag_target.y-.5*window.drag_target.height*window.drag_target.scaleX,t=(window.mousePosition.x-e)/(window.drag_target.width*window.drag_target.scaleX),o=(window.mousePosition.y-n)/(window.drag_target.height*window.drag_target.scaleX);if(0<t&&0<o&&t<1&&o<1)if(window.creativeCanvas.re=!0,window.creativeCanvas.rex=t,window.creativeCanvas.rey=o,window.creativeCanvas.refresh_current_point_index(),-1<window.creativeCanvas.current_index){var i=window.creativeCanvas.points_XYRGBR[window.creativeCanvas.current_index],r=[i[2],i[3],i[4]];window.color_picker_main.float_do(new cc.color(r[0],r[1],r[2])),window.minecraft.set_cur_color([r[0],r[1],r[2]]),window.pickCanvas.currentColor[0]=r[0],window.pickCanvas.currentColor[1]=r[1],window.pickCanvas.currentColor[2]=r[2]}else{var a=window.previewImageCanvas;window.girdNode.active&&(a=window.girdImageCanvas);var d=a.get_color(t,o);window.color_picker_main.float_do(d),window.minecraft.set_cur_color([d.r,d.g,d.b]),window.pickCanvas.currentColor[0]=d.r,window.pickCanvas.currentColor[1]=d.g,window.pickCanvas.currentColor[2]=d.b}}},end_picking:function(){void 0!==window.dropper_node&&(this.do_picking(),window.pickCanvas.floatingColor[0]=window.dropper_node.color.r,window.pickCanvas.floatingColor[1]=window.dropper_node.color.g,window.pickCanvas.floatingColor[2]=window.dropper_node.color.b,window.dropper_node.x=122,window.dropper_node.y=268,window.color_picker_main.pick_do())}}),cc._RF.pop()},{}],dragtarget:[function(e,n,t){"use strict";cc._RF.push(n,"16ac9dXjiBLKrkojVzbW1dk","dragtarget"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){window.drag_target=this.node}}),cc._RF.pop()},{}],eraser_masker:[function(e,n,t){"use strict";cc._RF.push(n,"d389dAkX0JBZruQtEeVulcE","eraser_masker"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){window.eraser_masker=this.node},update:function(e){this.node.x=window.mousePosition.x-cc.winSize.width/2,this.node.y=window.mousePosition.y-cc.winSize.height/2}}),cc._RF.pop()},{}],faceSelector:[function(r,e,n){"use strict";cc._RF.push(e,"8c11b3zCbJK37zCkjWNkHWp","faceSelector"),cc.Class({extends:cc.Component,properties:{bigFaceNode:{default:null,type:cc.Node},faceNodes:{default:[],type:cc.Node}},onLoad:function(){window.faceSeletor=this},start:function(){var e=this;window.faceID=-233,window.faceSeletor=this,window.bigFaceNode=this.bigFaceNode,window.bigFaceSprite=this.bigFaceNode.getComponent("cc.Sprite");for(var n=function(n){e.faceNodes[n].getComponent(cc.Sprite).spriteFrame=new cc.SpriteFrame,e.faceNodes[n].getComponent(cc.Sprite).spriteFrame.setTexture(cc.textureCache.addImage("res\\raw-assets\\face_128\\"+(n+1)+".jpg")),e.faceNodes[n].on(cc.Node.EventType.MOUSE_UP,function(e){window.faceSeletor.on_face_selected(n)})},t=0;t<32;t++)n(t);var o=r("./ImageLoader"),i=r("./ImageCanvas");window.faceImageLoader=o("faceImage"),window.faceImageCanvas=i("faceImage"),this.on_face_selected(Math.floor(32*Math.random())),this.bigFaceNode.on("mousemove",function(e){window.mousePosition=e.getLocation();var n=150-.5*window.bigFaceNode.width,t=1290-.5*window.bigFaceNode.height,o=(1*window.mousePosition.x-n)/(1*window.bigFaceNode.width),i=(1*window.mousePosition.y-t)/(1*window.bigFaceNode.height);if(0<o&&0<i&&o<1&&i<1){var r=window.faceImageCanvas.get_color(o,i);window.color_picker_main.float_do(r)}}),this.bigFaceNode.on("mousedown",function(e){window.color_picker_main.pick_do()})},on_face_selected:function(e){window.faceID=e,window.faceImageLoader.load_url("res\\raw-assets\\face_512\\"+(e+1)+".jpg",function(e){window.bigFaceSprite.spriteFrame=window.faceImageCanvas.load_image(e,240,240),window.bigFaceNode.width=240,window.bigFaceNode.height=240}),window.girdNode.active?window.controller.to_gird():window.controller.hide_light(),window.creativeCanvas.flush_bg(),this.flush_preview()},on_upload:function(){0!=window.hasSketch&&window.fileSelector.activate(window.faceSeletor.load_reference)},flush_preview:function(){window.in_color?this.flush_preview_color():this.flush_preview_light()},on_toggle_v4v2:function(){window.controller.hide_light(),window.faceSeletor.flush_preview()},flush_preview_color:function(){if(!window.uploading&&0!=window.hasSketch){window.controller.net_lock("uploading",0);var n=new XMLHttpRequest;n.open("POST",window.server_url+"/request_v2_result",!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded;"),n.upload.onprogress=function(e){if(e.lengthComputable){var n=e.loaded/e.total;.8<n?window.controller.net_lock("painting",0):window.controller.net_lock("uploading",n)}},n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){window.controller.net_lock("downloading",0);var e=n.responseText.split("_");window.current_room=e[0],window.current_step=e[1],console.log("get room id "+window.current_room),console.log("get step id "+window.current_step),window.girdNode.active?(window.girdImageLoader.on_process=function(e){window.controller.net_lock("downloading",e)},window.girdImageLoader.on_error=function(e){window.controller.net_unlock("error")},window.girdImageLoader.on_finish=function(e){window.controller.net_unlock("finished")},window.girdImageLoader.load_url(window.server_url+"/rooms/"+window.current_room+"/gird."+window.current_step+".jpg",function(e){window.girdSprite.spriteFrame=window.girdImageCanvas.load_image(e,e.width,e.height),window.bghintSprite.spriteFrame=window.renderImageCanvas.dark(),window.alphaSketchSprite.spriteFrame=window.sketchImageCanvas.clear(),window.hasRender=!1,window.controller.to_gird(),window.controller.net_unlock("finished"),window.resultImageLoader.on_error=null,window.resultImageLoader.on_process=null,window.resultImageLoader.on_finish=null,window.resultImageLoader.load_url(window.server_url+"/rooms/"+window.current_room+"/result."+window.current_step+".jpg",function(e){window.previewSprite.spriteFrame=window.previewImageCanvas.load_image(e,e.width,e.height)})})):(window.resultImageLoader.on_process=function(e){window.controller.net_lock("downloading",e)},window.resultImageLoader.on_error=function(e){window.controller.net_unlock("error")},window.resultImageLoader.on_finish=function(e){window.controller.net_unlock("finished")},window.resultImageLoader.load_url(window.server_url+"/rooms/"+window.current_room+"/result."+window.current_step+".jpg",function(e){window.previewSprite.spriteFrame=window.previewImageCanvas.load_image(e,e.width,e.height),window.bghintSprite.spriteFrame=window.renderImageCanvas.dark(),window.alphaSketchSprite.spriteFrame=window.sketchImageCanvas.clear(),window.hasRender=!1,window.controller.hide_light(),window.controller.net_unlock("finished"),window.girdImageLoader.on_error=null,window.girdImageLoader.on_process=null,window.girdImageLoader.on_finish=null,window.girdImageLoader.load_url(window.server_url+"/rooms/"+window.current_room+"/gird."+window.current_step+".jpg",function(e){window.girdSprite.spriteFrame=window.girdImageCanvas.load_image(e,e.width,e.height)})}))}else 4==n.readyState&&window.controller.net_unlock("error")},n.send("room="+window.current_room+"&points="+encodeURIComponent(JSON.stringify(window.creativeCanvas.points_XYRGBR))+"&face="+(window.faceID<0?encodeURIComponent(window.faceImageCanvas.canvas.toDataURL("image/png")):"null")+"&faceID="+(window.faceID+65535)+"&need_render=0&skipper=null&inv4="+(window.V4_toggle.isChecked?"1":"0")+"&r="+window.lighter.light_R_slider.progress+"&g="+window.lighter.light_G_slider.progress+"&b="+window.lighter.light_B_slider.progress+"&h="+window.lighter.light_H_slider.progress+"&d="+window.light_direction),console.log("request sended")}},flush_preview_light:function(){if(!window.uploading&&0!=window.hasSketch&&"new"!=window.current_step){window.controller.net_lock("uploading",0);var n=new XMLHttpRequest;n.open("POST",window.server_url+"/request_v2_result",!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded;"),n.upload.onprogress=function(e){if(e.lengthComputable){var n=e.loaded/e.total;.8<n?window.controller.net_lock("painting",0):window.controller.net_lock("uploading",n)}},n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){window.controller.net_lock("downloading",0);var e=n.responseText.split("_");window.current_room=e[0],window.current_step=e[1],console.log("get room id "+window.current_room),console.log("get step id "+window.current_step),window.renderImageLoader.on_process=function(e){window.controller.net_lock("downloading",e)},window.renderImageLoader.on_error=function(e){window.controller.net_unlock("error")},window.renderImageLoader.on_finish=function(e){window.controller.net_unlock("finished")},window.renderImageLoader.load_url(window.server_url+"/rooms/"+window.current_room+"/result."+window.current_step+".jpg",function(e){window.bghintSprite.spriteFrame=window.renderImageCanvas.load_image(e,e.width,e.height),window.alphaSketchSprite.spriteFrame=window.sketchImageCanvas.clear(),window.hasRender=!0,window.controller.show_light(),window.controller.net_unlock("finished")})}else 4==n.readyState&&window.controller.net_unlock("error")},n.send("room="+window.current_room+"&points="+encodeURIComponent(JSON.stringify(window.creativeCanvas.points_XYRGBR))+"&need_render=2&skipper="+window.current_step+"&inv4="+(window.V4_toggle.isChecked?"1":"0")+"&r="+window.lighter.light_R_slider.progress+"&g="+window.lighter.light_G_slider.progress+"&b="+window.lighter.light_B_slider.progress+"&h="+window.lighter.light_H_slider.progress+"&d="+window.light_direction),console.log("request sended")}},load_reference:function(e){window.faceImageLoader.load_url(e,function(e){if(!(e.width>2.5*e.height||e.height>2.5*e.width)){var n=window.regulator.maxRegulate([e.width,e.height],240);window.bigFaceSprite.spriteFrame=window.faceImageCanvas.load_image(e,n[0],n[1]),window.bigFaceNode.width=n[0],window.bigFaceNode.height=n[1],window.faceID=-233,window.controller.hide_light(),window.faceSeletor.flush_preview()}})}}),cc._RF.pop()},{"./ImageCanvas":"ImageCanvas","./ImageLoader":"ImageLoader"}],fake_bar:[function(e,n,t){"use strict";cc._RF.push(n,"61dcdov4D1Nc6gCTDSTIWPe","fake_bar"),cc.Class({extends:cc.Component,properties:{lab:{default:null,type:cc.Label},lab2:{default:null,type:cc.Label},prof:{default:null,type:cc.Node},prob:{default:null,type:cc.Node}},onLoad:function(){(window.fake_bar_pro=this).text="finished",this.progress=1},change:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;this.text=e,this.progress=n},update:function(e){this.progress+=.005*(1-this.progress),1<this.progress&&(this.progress=1),this.lab.string=this.text+" ("+parseInt(100*this.progress)+"%)",this.lab2.string=this.lab.string,this.prof.width=parseInt(this.prob.width*this.progress),this.prob.active=this.progress<1}}),cc._RF.pop()},{}],lighter:[function(e,n,t){"use strict";cc._RF.push(n,"90b3at5d8FPDJEjfZXvwb7o","lighter"),cc.Class({extends:cc.Component,properties:{light_R_slider:{default:null,type:cc.Slider},light_G_slider:{default:null,type:cc.Slider},light_B_slider:{default:null,type:cc.Slider},light_H_slider:{default:null,type:cc.Slider},light_TT_slider:{default:null,type:cc.Toggle},light_TF_slider:{default:null,type:cc.Toggle},light_FT_slider:{default:null,type:cc.Toggle},light_FF_slider:{default:null,type:cc.Toggle},bgs:{default:null,type:cc.Node}},onLoad:function(){window.lighter=this},start:function(){this.light_R_slider.progress=.99,this.light_G_slider.progress=.83,this.light_B_slider.progress=.66,this.light_H_slider.progress=100/600,window.lighter=this,window.light_direction=0,this.reflush()},light_direction_0:function(){window.light_direction=0},light_direction_1:function(){window.light_direction=1},light_direction_2:function(){window.light_direction=2},light_direction_3:function(){window.light_direction=3},reflush:function(){this.bgs.color=cc.color(parseInt(255*this.light_R_slider.progress),parseInt(255*this.light_G_slider.progress),parseInt(255*this.light_B_slider.progress),255)}}),cc._RF.pop()},{}],mc:[function(e,n,t){"use strict";cc._RF.push(n,"9f420tBdblH772q0XTCwvMY","mc"),cc.Class({extends:cc.Component,properties:{c0:{default:null,type:cc.Sprite},c1:{default:null,type:cc.Sprite},c2:{default:null,type:cc.Sprite},c3:{default:null,type:cc.Sprite},c4:{default:null,type:cc.Sprite},c5:{default:null,type:cc.Sprite},c6:{default:null,type:cc.Sprite},c7:{default:null,type:cc.Sprite},c8:{default:null,type:cc.Sprite},kuang:{default:null,type:cc.Sprite}},onLoad:function(){window.minecraft=this},start:function(){this.sps=[this.c0,this.c1,this.c2,this.c3,this.c4,this.c5,this.c6,this.c7,this.c8],(window.minecraft=this).big9=[[255,255,255],[255,230,200],[137,148,170],[150,164,141],[229,202,209],[249,233,218],[0,233,1],[1,233,0],[154,81,255]],this.reload_all(),this.index=4,this.set_index(0),window.in_color=!0,this.shift(),setTimeout("window.pickCanvas.record=window.pickCanvas.bigall;window.pickCanvas.finish();",200)},set_0:function(){this.set_index(0)},set_1:function(){this.set_index(1)},set_2:function(){this.set_index(2)},set_3:function(){this.set_index(3)},set_4:function(){this.set_index(4)},set_5:function(){this.set_index(5)},set_6:function(){this.set_index(6)},set_7:function(){this.set_index(7)},set_8:function(){this.set_index(8)},refresh:function(){for(var e=0;e<9;e++)this.set_color(e,[0,0,0]);setTimeout("window.minecraft.reload_all();window.minecraft.set_index(window.minecraft.index);",100)},reload_all:function(){for(var e=0;e<9;e++)this.set_color(e,this.big9[e])},set_index:function(e){if(-233==e)return this.index=e,void(this.kuang.node.active=!1);this.kuang.node.active=!0,e<0&&(e=0),8<e&&(e=8),this.index=e,this.kuang.node.x=100*e-400,-1<this.index&&this.index<5&&(window.pickCanvas.floatingColor[0]=this.sps[this.index].node.color.r,window.pickCanvas.floatingColor[1]=this.sps[this.index].node.color.g,window.pickCanvas.floatingColor[2]=this.sps[this.index].node.color.b,window.color_picker_main.pick_float(),window.isPen=!0,window.in_move=!1,window.eraser_masker.active=!1),5==this.index&&(window.isPen=!0,window.in_move=!1,window.eraser_masker.active=!1),6==this.index&&(window.isPen=!0,window.in_move=!1,window.eraser_masker.active=!1),7==this.index&&(window.isPen=!0,window.in_move=!0,window.eraser_masker.active=!1),8==this.index&&(window.isPen=!1,window.in_move=!1,window.eraser_masker.active=!0)},set_color:function(e,n){-1<e&&e<5&&(this.sps[e].node.color=cc.color(n[0],n[1],n[2],255))},shift:function(){for(var e=0;e<5;e++)this.sps[e].node.active=window.in_color;for(var n=5;n<7;n++)this.sps[n].node.active=!window.in_color;7!=this.index&&8!=this.index&&(window.in_color&&4<this.index&&this.set_index(0),window.in_color||this.index<5&&this.set_index(5))},go_pen:function(){5!=this.index&&6!=this.index&&7!=this.index&&8!=this.index||(this.index=0,this.kuang.node.x=-400)},set_cur_color:function(e){-1<this.index&&this.index<5&&(this.sps[this.index].node.color=cc.color(e[0],e[1],e[2],255))}}),cc._RF.pop()},{}],selfrot:[function(e,n,t){"use strict";cc._RF.push(n,"985733m0s1I44Gbui8XNyvc","selfrot"),cc.Class({extends:cc.Component,properties:{},start:function(){},update:function(e){this.node.rotation+=30*e}}),cc._RF.pop()},{}],shift50:[function(e,n,t){"use strict";cc._RF.push(n,"e8cf1Q/isJAM4tJYI+kKutU","shift50"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){window.shifter_50=this},up50:function(){this.node.x=50},down50:function(){this.node.x=-50}}),cc._RF.pop()},{}],shiftlr:[function(e,n,t){"use strict";cc._RF.push(n,"ff80e/rKS5NvaF8zKm4aA06","shiftlr"),cc.Class({extends:cc.Component,properties:{btn_show:{default:null,type:cc.Node},btn_hide:{default:null,type:cc.Node},btn_a:{default:null,type:cc.Node},btn_b:{default:null,type:cc.Node}},show:function(){this.btn_show.active=!1,this.btn_hide.active=!0,this.btn_a.active=!0,this.btn_b.active=!0},hide:function(){this.btn_show.active=!0,this.btn_hide.active=!1,this.btn_a.active=!1,this.btn_b.active=!1}}),cc._RF.pop()},{}]},{},["BoxCanvas","CreativeCanvas","FileInputs","ImageCanvas","ImageLoader","PickCanvas","SizeRegulator","TripleCanvas","colorpicker","controller","dragbox","dragtarget","eraser_masker","faceSelector","fake_bar","lighter","mc","selfrot","shift50","shiftlr"]);